#!/bin/bash
set -e

test_style()
{
  cd ./tests/style/ && ./testall && cd -
}

test_unit()
{
  cd ./tests/unit/ && ./testall && cd -
}

test_python()
{
  [ -x "$(command -v pylint3)" ] && pylintCmd="pylint3" || pylintCmd="pylint"
  find . -path ./api -prune -o -name '*.py' -exec echo "Running pylint on {}" \; -exec ${pylintCmd} -E --disable=C,R --init-hook="import sys; sys.path.append('./tools')" --persistent=n {} \;
}

test_typos()
{
  typos --exclude builder* --exclude tree/20_cfe_basics/cfengine
}

if [ "$1" = "--python" ]; then
  test_python
  exit 0
elif [ "$1" = "--style" ]; then
  test_style
  exit 0
elif [ "$1" = "--unit" ]; then
  test_unit
  exit 0
elif [ "$1" = "--typos" ]; then
  test_typos
  exit 0
else
  test_python
  test_style
  test_unit
  exit 0
fi
